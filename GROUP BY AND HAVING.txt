--GROUP BY
----------
--WAQTD NUMBER OF EMPLOYEES WORKING IN EACH DEPT EXCEPT PRESIDENT
SELECT * FROM SCOTT.EMP;

SELECT COUNT(*),DEPTNO
FROM SCOTT.EMP
WHERE JOB NOT IN 'PRESIDENT'
GROUP BY DEPTNO;

--WAQTD TOTAL SALARY NEEDED TO PAY ALL THE EMPLOYEES IN JOB

SELECT SUM(SAL) AS "TOTAL SAL",JOB
FROM SCOTT.EMP
GROUP BY JOB;

--WAQTD NUMBER OF EMPLOYEES WORKING AS MANAGER IN EACH DEPT

SELECT COUNT(*) AS "TOTAL NO OF MANAGERS",DEPTNO
FROM SCOTT.EMP
WHERE JOB IN ('MANAGER')
GROUP BY DEPTNO;

-- WAQTD AVG SALARY NEEDED TO PAY ALL THE EMPLOYEES IN EACH DEPT EXCLUDING THE EMPLOYEES OF DEPTNO 20

SELECT AVG(SAL),DEPT
FROM SCOTT.EMP
WHERE DEPTNO NOT IN 20
GROUP BY JOB;

-- WAQTD NUMBER OF EMPLOYEES HAVING CHARACTER 'A' IN THEIR NAMES IN EACH JOB
SELECT COUNT(*)
FROM SCOTT.EMP
WHERE ENAME LIKE '%A'
GROUP BY JOB;

--WAQTD NUMBER OF EMP AND AVERAGE SALARY NEEDED TO PAY THE EMPLOYEES WHOSE SAL IN GREATER THAN 2000 IN EACH DEPT

SELECT COUNT(*)
FROM SCOTT.EMP
WHERE SAL>2000
GROUP BY DEPT;

-- WAQTD TOTAL SAL NEEDED TO PAY AND NUMBER OF SALESMAN IN EACH DEPT
SELECT SUM(SAL),COUNT(*)
FROM SCOTT.EMP
WHERE JOB = 'SALESMAN'
GROUP BY JOB;

--WAQTD NUMER OF EMPLOYEES WITH THEIR MAX SALARY IN EACH JOB

SELECT COUNT(*),MAX(SAL),JOB
FROM SCOTT.EMP
GROUP BY JOB;

-- WAQTD MAXIMUM SALARIES GIVEN TO AN EMPLOYEE WORKING IN EACH DEPT

SELECT MAX(SAL),DEPTNO
FROM SCOTT.EMP
GROUP BY DEPTNO;

--WAQTD NUMBER OF TIMES THE SALARIES PRESENT IN THE TABLE IN EACH JOB

SELECT COUNT(SAL),JOB
FROM SCOTT.EMP
GROUP BY JOB;

--HAVING CLAUSE
-------------------------

--WAQTD DEPTNO AND NUMBER OF EMP WORKING IN EACH DEPT IF THERE ARE ATLEAST 2 CLERKS IN EACH DEPT

SELECT DEPTNO,COUNT(*)
FROM SCOTT.EMP
WHERE JOB = 'CLERK'
GROUP BY JOB
HAVING COUNT(*)>=2;

--WAQTD DEPTNO AND TOTAL SALARY NEEDED TO PAY ALL EMP IN EACH DEPT THERE ARE ATLEAST 4 RMP IN EACH DEPT

SELECT DEPTNO,SUM(SAL)
FROM SCOTT.EMP
GROUP BY DEPTNO
HAVING COUNT(*)>=4;

--3.WAQTD NUMBER OF EMP EARNING SAL MORE THAN 1200 IN EACH JOB AND THE TOTAL SAL NEED TO PAY EMP OF EACH JOB MUST 
 -- EXCESS 3800

SELECT COUNT(*),JOB,SUM(SAL)
FROM SCOTT.EMP
WHERE SAL>1200 
GROUP BY JOB
HAVING SUM(SAL)>3800;

--4. WAQTD DEPTNO AND NO OF EMPLOYEES WORKING ONLY IF THERE ARE 2 EMPLOYEES ARE  WORKING AS MANAGER IN EACH DPARTMENT

SELECT DEPTNO,COUNT(*)
FROM SCOTT.EMP
WHERE JOB = 'MANAGER'
GROUP BY DEPTNO
HAVING COUNT(*)>=2;

--5.WAQTD JOB AND  MAX SAL  OF EMP IN EACH JOB AND MAX SAL EXCESS 2600

SELECT JOB,MAX(SAL)
FROM SCOTT.EMP
GROUP BY JOB
HAVING MAX(SAL)>2600;

--6.WAQTD SALARIES WHICH ARE REPEATED IN THE TABLE

SELECT COUNT(*),SAL
FROM SCOTT.EMP
GROUP BY SAL
HAVING COUNT(*)>1;

--7. WAQTD HIREDATE WHICH ARE DUPLICATED IN THE EMP TABLE

SELECT HIREDATE,COUNT(*)
FROM SCOTT.EMP
GROUP BY HIREDATE
HAVING COUNT(*)>1;

--8. WAQTD AVERAGE SALARY OF EACH DEPT IF AVERAGE SALARY IS LESS THAN 3000
SELECT ROUND(AVG(SAL)),DEPTNO
FROM SCOTT.EMP
GROUP BY DEPTNO
HAVING AVG(SAL)<3000;


--9. WRITE A QUERY TO DISPLAY, DEPTNO IF THERE ARE ATLEAST 3 EMP IN EACH DEPT WHOSE NAME HAS CHAR 'A' OR 'S';

SELECT DEPTNO
FROM SCOTT.EMP
WHERE ENAME LIKE '%A%' OR '%S%'
GROUP BY DEPTNO
HAVING COUNT(DISTINCT(ENAME))>=3;


--10.WAQTD MIN AND MAX SALARIES OF EACH JOB IF MIN SAL IS MORE THAN 1000 AND MAX SAL IS LESS THAN 5000.

SELECT MIN(SAL),MAX(SAL),JOB
FROM SCOTT.EMP
GROUP BY JOB
HAVING MIN(SAL) > 1000 AND MAX(SAL)<5000;


